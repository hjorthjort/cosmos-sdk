(window.webpackJsonp=window.webpackJsonp||[]).push([[226],{858:function(e,i,o){"use strict";o.r(i);var t=o(1),n=Object(t.a)({},(function(){var e=this,i=e.$createElement,o=e._self._c||i;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"state"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#state"}},[e._v("#")]),e._v(" State")]),e._v(" "),o("h2",{attrs:{id:"signing-info-liveness"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#signing-info-liveness"}},[e._v("#")]),e._v(" Signing Info (Liveness)")]),e._v(" "),o("p",[e._v("Every block includes a set of precommits by the validators for the previous block,\nknown as the "),o("code",[e._v("LastCommitInfo")]),e._v(" provided by Tendermint. A "),o("code",[e._v("LastCommitInfo")]),e._v(" is valid so\nlong as it contains precommits from +2/3 of total voting power.")]),e._v(" "),o("p",[e._v("Proposers are incentivized to include precommits from all validators in the "),o("code",[e._v("LastCommitInfo")]),e._v("\nby receiving additional fees proportional to the difference between the voting\npower included in the "),o("code",[e._v("LastCommitInfo")]),e._v(" and +2/3 (see "),o("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/issues/967",target:"_blank",rel:"noopener noreferrer"}},[e._v("TODO"),o("OutboundLink")],1),e._v(").")]),e._v(" "),o("p",[e._v("Validators are penalized for failing to be included in the "),o("code",[e._v("LastCommitInfo")]),e._v(" for some\nnumber of blocks by being automatically jailed, potentially slashed, and unbonded.")]),e._v(" "),o("p",[e._v("Information about validator's liveness activity is tracked through "),o("code",[e._v("ValidatorSigningInfo")]),e._v(".\nIt is indexed in the store as follows:")]),e._v(" "),o("ul",[o("li",[e._v("ValidatorSigningInfo: "),o("code",[e._v("0x01 | ConsAddress -> amino(valSigningInfo)")])]),e._v(" "),o("li",[e._v("MissedBlocksBitArray: "),o("code",[e._v("0x02 | ConsAddress | LittleEndianUint64(signArrayIndex) -> VarInt(didMiss)")])])]),e._v(" "),o("p",[e._v("The first mapping allows us to easily lookup the recent signing info for a\nvalidator based on the validator's consensus address. The second mapping acts\nas a bit-array of size "),o("code",[e._v("SignedBlocksWindow")]),e._v(" that tells us if the validator missed\nthe block for a given index in the bit-array. The index in the bit-array is given\nas little endian uint64.")]),e._v(" "),o("p",[e._v("The result is a "),o("code",[e._v("varint")]),e._v(" that takes on "),o("code",[e._v("0")]),e._v(" or "),o("code",[e._v("1")]),e._v(", where "),o("code",[e._v("0")]),e._v(" indicates the\nvalidator did not miss (did sign) the corresponding block, and "),o("code",[e._v("1")]),e._v(" indicates\nthey missed the block (did not sign).")]),e._v(" "),o("p",[e._v("Note that the "),o("code",[e._v("MissedBlocksBitArray")]),e._v(" is not explicitly initialized up-front. Keys\nare added as we progress through the first "),o("code",[e._v("SignedBlocksWindow")]),e._v(" blocks for a newly\nbonded validator. The "),o("code",[e._v("SignedBlocksWindow")]),e._v(" parameter defines the size\n(number of blocks) of the sliding window used to track validator liveness.")]),e._v(" "),o("p",[e._v("The information stored for tracking validator liveness is as follows:")]),e._v(" "),o("code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"Ly8gVmFsaWRhdG9yU2lnbmluZ0luZm8gZGVmaW5lcyBhIHZhbGlkYXRvcidzIHNpZ25pbmcgaW5mbyBmb3IgbW9uaXRvcmluZyB0aGVpcgovLyBsaXZlbmVzcyBhY3Rpdml0eS4KbWVzc2FnZSBWYWxpZGF0b3JTaWduaW5nSW5mbyB7CiAgc3RyaW5nIGFkZHJlc3MgPSAxOwogIC8vIGhlaWdodCBhdCB3aGljaCB2YWxpZGF0b3Igd2FzIGZpcnN0IGEgY2FuZGlkYXRlIE9SIHdhcyB1bmphaWxlZAogIGludDY0IHN0YXJ0X2hlaWdodCA9IDI7CiAgLy8gaW5kZXggb2Zmc2V0IGludG8gc2lnbmVkIGJsb2NrIGJpdCBhcnJheQogIGludDY0IGluZGV4X29mZnNldCA9IDM7CiAgLy8gdGltZXN0YW1wIHZhbGlkYXRvciBjYW5ub3QgYmUgdW5qYWlsZWQgdW50aWwKICBnb29nbGUucHJvdG9idWYuVGltZXN0YW1wIGphaWxlZF91bnRpbCA9IDQ7CiAgLy8gd2hldGhlciBvciBub3QgYSB2YWxpZGF0b3IgaGFzIGJlZW4gdG9tYnN0b25lZCAoa2lsbGVkIG91dCBvZiB2YWxpZGF0b3IKICAvLyBzZXQpCiAgYm9vbCB0b21ic3RvbmVkID0gNTsKICAvLyBtaXNzZWQgYmxvY2tzIGNvdW50ZXIgKHRvIGF2b2lkIHNjYW5uaW5nIHRoZSBhcnJheSBldmVyeSB0aW1lKQogIGludDY0IG1pc3NlZF9ibG9ja3NfY291bnRlciA9IDY7Cn0K"}}),e._v(" "),o("p",[e._v("Where:")]),e._v(" "),o("ul",[o("li",[o("strong",[e._v("Address")]),e._v(": The validator's consensus address.")]),e._v(" "),o("li",[o("strong",[e._v("StartHeight")]),e._v(": The height that the candidate became an active validator\n(with non-zero voting power).")]),e._v(" "),o("li",[o("strong",[e._v("IndexOffset")]),e._v(": Index which is incremented each time the validator was a bonded\nin a block and may have signed a precommit or not. This in conjunction with the\n"),o("code",[e._v("SignedBlocksWindow")]),e._v(" param determines the index in the "),o("code",[e._v("MissedBlocksBitArray")]),e._v(".")]),e._v(" "),o("li",[o("strong",[e._v("JailedUntil")]),e._v(": Time for which the validator is jailed until due to liveness downtime.")]),e._v(" "),o("li",[o("strong",[e._v("Tombstoned")]),e._v(": Desribes if the validator is tombstoned or not. It is set once the\nvalidator commits an equivocation or for any other configured misbehiavor.")]),e._v(" "),o("li",[o("strong",[e._v("MissedBlocksCounter")]),e._v(": A counter kept to avoid unnecessary array reads. Note\nthat "),o("code",[e._v("Sum(MissedBlocksBitArray)")]),e._v(" equals "),o("code",[e._v("MissedBlocksCounter")]),e._v(" always.")])])],1)}),[],!1,null,null,null);i.default=n.exports}}]);